<div class="instrument-card">
  <h1><%= @applied_instrument.instrument.title %></h1>

  <% @applied_instrument.instrument.questions.each do |question| %>
    <div><%= question.description %></div>
    <% question.answers.each do |answer| %>
      <% if current_user.psychologist? %>
        <div><%= answer.position %> - <%= answer.description %></div>
        <% if answer.evaluated_answers.where(user: @applied_instrument.user).any? %>
          <div>Resposta do Avaliado: <%= answer.evaluated_answers.where(user: @applied_instrument.user).first.answer.description %></div>
        <% end %>
      <% end %>
    <% end %>

    <% if current_user.patient? %>
      <% if current_user.evaluated_answers.select { |a| a.answer.question == question && a.applied_instrument == @applied_instrument }.any? %>
        <%= current_user.evaluated_answers.select { |a| a.answer.question == question && a.applied_instrument == @applied_instrument }.first.answer.description %>
      <% else %>
        <%= simple_form_for [@applied_instrument, @evaluated_answer] do |f| %>
          <%= f.collection_radio_buttons :answer_id, question.answers, :id, :description %>
          <%= f.submit 'Salvar Resposta' %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <% if current_user.patient?  %>
    <%= link_to 'Finalizar', applied_instrument_finish_instrument_path(@applied_instrument), data: { turbo_method: :post } %>
  <% end %>
</div>

<%= link_to 'log_out', destroy_user_session_path, data: { turbo_method: :delete } %>
